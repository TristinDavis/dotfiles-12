# Various hacks and bullshit to get a sane environment going on OSX.
# brew --prefix <pkg> is way, way too slow for use here;
# hardcode paths instead.

paths=(
    "${HOME}/bin" \
    "/usr/local/bin" \
    "/usr/local/opt/curl/bin" \
    "/usr/local/opt/coreutils/libexec/gnubin" \
    "/usr/local/opt/findutils/libexec/gnubin" \
    "/usr/local/opt/gnu-sed/libexec/gnubin" \
    "/usr/local/opt/gnu-tar/libexec/gnubin" \
    "/usr/local/opt/gnu-which/libexec/gnubin" \
    "/usr/local/opt/grep/libexec/gnubin" \
    "/usr/local/opt/make/libexec/gnubin" \
    "/usr/local/opt/python/libexec/bin" \
)

manpaths=(
    "$HOME/man" \
    "/usr/local/opt/curl/share/man" \
    "/usr/local/opt/coreutils/libexec/gnuman" \
    "/usr/local/opt/findutils/libexec/gnuman" \
    "/usr/local/opt/gnu-sed/libexec/gnuman" \
    "/usr/local/opt/gnu-tar/libexec/gnuman" \
    "/usr/local/opt/gnu-which/libexec/gnuman" \
    "/usr/local/opt/grep/libexec/gnuman" \
    "/usr/local/opt/make/libexec/gnuman" \
)

export ANDROID_HOME=/usr/local/opt/android-sdk

export PATH="${(j|:|)paths}:${PATH}"
export MANPATH="${(j|:|)manpaths}:${MANPATH}"

# Lazy-load NVM because it increases startup by an order of magnitude(!).
# https://gist.github.com/fl0w/07ce79bd44788f647deab307c94d6922
export NVM_DIR=$HOME/.nvm
lazynvm() {
    unset -f nvm node npm npx
    source /usr/local/opt/nvm/nvm.sh
}

nvm () { lazynvm; nvm $@; };
node () { lazynvm; env NODE_NO_READLINE=1 rlwrap node $@; };
npm () { lazynvm; npm $@; };
npx () { lazynvm; npx $@; };
